"""
Конфигурация системы камер и комнат.

Этот файл содержит все настройки системы. Здесь можно:
1. Настроить камеры и комнаты
2. Изменить параметры детекции (YOLO)
3. Изменить параметры трекинга
4. Настроить логику перемещений
5. Настроить веб-сервер

ИЗМЕНЕНИЕ ЭТОГО ФАЙЛА - основной способ настройки системы.
"""
from typing import List, Dict


# ============================================
# КОНФИГУРАЦИЯ КАМЕР И КОМНАТ
# ============================================
# CAMERAS_CONFIG - список всех камер в системе
# Каждая камера привязана к комнате

# camera_index может быть:
# - Числом (0, 1, 2...) для USB камер
#   Обычно 0 - камера ноутбука, 1 - первая USB камера, 2 - вторая, и т.д.
# - Строкой с RTSP URL для IP камер
#   Формат: "rtsp://username:password@ip_address:port/stream_path"
#   Пример: "rtsp://admin:password123@192.168.1.100:554/stream1"

CAMERAS_CONFIG = [
    {
        "room_name": "Room1",      # Имя комнаты (будет отображаться в интерфейсе)
        "camera_index": 0,          # Камера ноутбука (обычно индекс 0)
    },
    # Для добавления дополнительных камер раскомментируйте:
    # {
    #     "room_name": "Room2",
    #     "camera_index": 1,  # USB камера с индексом 1
    # },
    # Пример для IP камеры:
    # {
    #     "room_name": "Room3",
    #     "camera_index": "rtsp://admin:password@192.168.1.100:554/stream",
    # },
]


# ============================================
# НАСТРОЙКИ ДЕТЕКЦИИ (YOLO)
# ============================================
# Эти параметры управляют работой YOLO - нейронной сети для поиска людей

DETECTION_CONFIG = {
    # Модель YOLO для детекции
    # При первом запуске файл автоматически скачается
    # Доступные модели (от быстрой к медленной, от менее точной к более точной):
    # - "yolov8n.pt" - nano (самая быстрая, менее точная) - рекомендуется для начала
    # - "yolov8s.pt" - small (быстрая, средняя точность)
    # - "yolov8m.pt" - medium (средняя скорость, хорошая точность)
    # - "yolov8l.pt" - large (медленная, высокая точность)
    # - "yolov8x.pt" - xlarge (самая медленная, самая точная)
    "model": "yolov8n.pt",
    
    # Порог уверенности для детекции (0.0 - 1.0)
    # 0.5 означает: "показывать только те детекции, где YOLO уверена >= 50%"
    # Чем меньше значение - тем больше детекций (но больше ложных срабатываний)
    # Чем больше значение - тем меньше детекций (но только очень уверенные)
    # Рекомендуемое значение: 0.5 (баланс между точностью и количеством)
    "confidence_threshold": 0.5,
    
    # Класс "person" в COCO dataset (на котором обучалась YOLO)
    # COCO имеет 80 классов объектов, person = класс 0
    # Не меняйте это значение, если не уверены
    "person_class_id": 0,
}

# ============================================
# НАСТРОЙКИ ТРЕКИНГА
# ============================================
# Эти параметры управляют работой трекера (ByteTrack или упрощенного)
# Трекер отвечает за присвоение ID людям и отслеживание их между кадрами

TRACKING_CONFIG = {
    # Порог для начала трекинга (минимальная уверенность детекции)
    # Если детекция имеет уверенность меньше этого значения - она не будет трекаться
    # Обычно равен confidence_threshold из DETECTION_CONFIG
    "track_thresh": 0.5,
    
    # Буфер для трекинга (количество кадров)
    # Сколько кадров хранить информацию о человеке после его исчезновения
    # Больше значение = трекер дольше "помнит" человека
    # УВЕЛИЧЕНО до 150 для лучшего запоминания людей (для 30 FPS = 5 секунд)
    # Рекомендуемое значение: 150 (для лучшего запоминания)
    "track_buffer": 150,
    
    # Порог для сопоставления треков (0.0 - 1.0)
    # Минимальное пересечение (IoU) между старым и новым bounding box
    # для того, чтобы считать их одним и тем же человеком
    # УМЕНЬШЕНО до 0.3 для более мягкого сопоставления (лучше восстанавливает старые треки)
    # Больше значение = более строгое сопоставление (меньше ошибок, но больше потерянных треков)
    # Меньше значение = более мягкое сопоставление (больше треков, но больше ошибок)
    # Рекомендуемое значение: 0.3 (для лучшего восстановления старых ID)
    "match_thresh": 0.3,
}

# ============================================
# НАСТРОЙКИ ПЕРЕМЕЩЕНИЙ
# ============================================
# Эти параметры управляют логикой определения перемещений между комнатами

MOVEMENT_CONFIG = {
    # Время (в секундах), через которое человек считается исчезнувшим
    # Если человек не появляется на кадре больше этого времени - удаляется из системы
    # Рекомендуемое значение: 7.0 секунд
    "disappearance_timeout": 7.0,
    
    # Окно времени для определения перемещения (в секундах)
    # Если человек исчез из Room1 и появился в Room2 в течение этого времени -
    # это считается перемещением между комнатами
    # Минимальное время: 1.0 секунда (чтобы не считать быстрое исчезновение/появление)
    # Максимальное время: обычно 7.0 секунд
    # Если человек исчез и появился через 10 секунд - это не перемещение,
    # он мог уйти и прийти обратно
    # Рекомендуемое значение: 7.0 секунд
    "movement_window": 7.0,
}

# ============================================
# НАСТРОЙКИ СКРИНШОТОВ И ЗАПИСИ
# ============================================
# Эти параметры управляют сохранением скриншотов и записью видео

SCREENSHOT_CONFIG = {
    # Автоматическое сохранение скриншотов при событиях
    # True - скриншоты сохраняются автоматически при входе/выходе/перемещении
    # False - автоматические скриншоты отключены (можно делать вручную)
    "auto_screenshots": True,
    
    # Директория для сохранения скриншотов
    "screenshots_dir": "screenshots",
    
    # Качество JPEG для скриншотов (1-100, где 100 - наилучшее качество)
    "jpeg_quality": 85,
}

VIDEO_RECORDING_CONFIG = {
    # Директория для сохранения записей видео
    "recordings_dir": "recordings",
    
    # Кодек для записи видео
    # 'mp4v' - MPEG-4 кодек (хорошая совместимость)
    # 'XVID' - Xvid кодек (лучшее сжатие)
    # 'MJPG' - Motion JPEG (быстрое, но большие файлы)
    "codec": "mp4v",
    
    # FPS для записи видео (кадров в секунду)
    "fps": 30,
    
    # Качество записи (1-100, влияет на битрейт)
    "quality": 80,
}

# ============================================
# НАСТРОЙКИ ВЕБ-СЕРВЕРА
# ============================================
# Эти параметры управляют Flask веб-сервером

SERVER_CONFIG = {
    # IP адрес для прослушивания
    # "0.0.0.0" - принимать подключения со всех сетевых интерфейсов
    # "127.0.0.1" или "localhost" - только локальные подключения
    # Рекомендуемое значение: "0.0.0.0" (чтобы можно было подключиться с других устройств)
    "host": "0.0.0.0",
    
    # Порт для веб-сервера
    # 5000 - стандартный порт Flask (по умолчанию)
    # Можно изменить на любой свободный порт (например, 8080, 3000)
    # Убедитесь, что порт не занят другим приложением
    "port": 5000,
    
    # Режим отладки
    # True - включен режим отладки (детальные ошибки, автоматическая перезагрузка)
    # False - режим отладки отключен (для продакшена)
    # Рекомендуемое значение: False для продакшена, True для разработки
    "debug": False,
}